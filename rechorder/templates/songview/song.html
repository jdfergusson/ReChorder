{% extends 'songview/_base.html' %}
{% load static %}

{% block javascript %}
    function toggleAdd() {
        $('#btn-song-add-to-set').removeClass('btn-successful');
        $('#add-actions-success').hide();

        $('#transposer').hide();
        $('#btn-toggle-transposer').removeClass('img-action-selected');
        $('#editor').hide();
        $('#btn-toggle-editor').removeClass('img-action-selected');

        $('#add-actions').toggle();
        $('#btn-add-to-set').toggleClass('img-action-selected');
    }

    function toggleTransposer() {
        $('#btn-song-add-to-set').removeClass('btn-successful');
        $('#add-actions-success').hide();

        $('#add-actions').hide();
        $('#btn-add-to-set').removeClass('img-action-selected');
        $('#editor').hide();
        $('#btn-toggle-editor').removeClass('img-action-selected');

        $('#transposer').toggle();
        $('#btn-toggle-transposer').toggleClass('img-action-selected');
    }

    function toggleEditor() {
        $('#btn-song-add-to-set').removeClass('btn-successful');
        $('#add-actions-success').hide();

        $('#add-actions').hide();
        $('#btn-add-to-set').removeClass('img-action-selected');
        $('#transposer').hide();
        $('#btn-toggle-transposer').removeClass('img-action-selected');

        $('#editor').toggle();
        $('#btn-toggle-editor').toggleClass('img-action-selected');
    }

    function addSongToSet(go_live) {
        var data = {'song_id': {{ song.pk }}};
        if (go_live) {
            data.go_live = true;
        }

        $.ajax({
            type: 'POST',
            url: '{% url 'set.add_song' %}',
            headers: { "X-CSRFToken": '{{ csrf_token }}' },
            data: data,
            dataType: 'json',
            success: function(data) {
                if (data.redirect) {
                    window.location = data.redirect;
                }
                else {
                    $('#btn-song-add-to-set').addClass('btn-successful');
                    $('#add-actions-success').show();
                }
            }
        });
    }

    $(function() {
        $('#add-actions').hide();
        $('#btn-add-to-set').click(toggleAdd);

        $('#editor').hide();
        $('#btn-toggle-editor').click(toggleEditor);

        $('#transposer').hide();
        $('#btn-toggle-transposer').click(toggleTransposer);

        $('#btn-song-add-to-set').click(function() {addSongToSet(false);});
        $('#btn-song-add-and-go').click(function() {addSongToSet(true);});
        $('#add-actions-success').hide();
    });
{% endblock %}

{% block header %}
    {% include 'songview/_header.html' with selected="songs" %}
{% endblock %}

{% block title %}
    <h1 id="song-title">{{ song.title }}</h1><br>
    <h2 id="song-artist">{{ song.artist }}</h2><br>
    <h3>Key of: <span id="key-shown"></span>. Capo: <span id="key-capo"></span></h3><br>

    <img class="img-actions" id='btn-add-to-set' src="{% static 'songview/icons/mdi-playlist-plus.svg' %}"><img class="img-actions" id="btn-toggle-transposer" src="{% static 'songview/icons/mdi-music-accidental-natural.svg' %}"><img class='img-actions' id="btn-toggle-editor" src="{% static 'songview/icons/mdi-pencil-outline.svg' %}">

    <div id="add-actions">
        <ul>
            <li>
                <button id="btn-song-add-to-set">Add to set list</button>
                <img id="add-actions-success" src="{% static 'songview/icons/mdi-check-box-outline.svg' %}">
            </li>
            <li><button id="btn-song-add-and-go">Add and go live</button></li>
        </ul>

    </div>

    {% include 'songview/_transposer.html' with sk_editable='true' %}

    {% include 'songview/_song_edit.html' %}
{% endblock %}

{% block content %}
        <div id="song">
            {% include 'songview/_print_song.html' %}
        </div>
{% endblock %}
